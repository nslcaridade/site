<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html" charset=UTF-8>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NSL</title>
<link rel="shortcut icon" th:href="@{../image/caridade.ico}" />
<link href="../css/bootstrap.css" rel="stylesheet" />
<link href="../dist/jquery.bootgrid.css" rel="stylesheet" />
<link href="../css/menu-customer.css" rel="stylesheet" />
<link href="../css/fontes-customer.css" rel="stylesheet" />
<script type="text/javascript" src="../js/moderniz.2.8.1.js"></script>

</head>
<body>
	<header>
		<div th:replace="fragmentos/header :: cabecalho"></div>
	</header>
	<header id="header" class="navbar navbar-default navbar-fixed-top">
		<div th:replace="fragmentos/header :: menu"></div>
	</header>
	<div class="container-fluid">
	
	<div style="text-align:center"><h4>Relatório de doação anual em Intens</h4></div>
		<table id="selecao" class="table table-condensed table-hover table-striped hidden-print" data-selection="true" data-multi-select="true" data-row-select="true" data-keep-selection="true">
			<thead>
				<tr>
					<th>
						<select name="ano" class="w3-select w3-select w3-border w3-margin-bottom" id="ano" required>
							<option selected="selected"></option>
							<option value=""/>
						</select>
    				</th>
				</tr>
			</thead>
		</table>
		<div class="row">
			<div class="col-md-12">
				<table id="gridRel" class="table table-condensed table-hover table-striped" data-row-select="true" data-keep-selection="true">
					<thead>
						<tr>
							<th data-column-id="id" data-identifier="true" data-type="numeric" data-visible="false" data-width="5%">ID</th>
							<th data-column-id="ano" data-type="numeric" data-visible="false" data-width="5%">ANO</th>
							<th data-column-id="entidade" data-type="text" data-visible="true" data-filterable="true" data-width="20%" >INSTITUIÇÃO</th>
							<th data-column-id="mes" data-type="numeric" data-visible="true" data-width="5%">MES</th>
							<th data-column-id="tipo" data-type="text" data-visible="true" data-filterable="true" data-width="20%" >TIPO</th>
							<th data-column-id="quantidade" data-type="text" data-visible="true" data-filterable="true" data-width="20%" >QUANTIDADE</th>
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
				<div class="row">
					<div class="col-md-5"></div>
					<div class="col-md-2">
						<div class="heart" id="AjaxLoader" ></div>
					</div>
					<div class="col-md-5"></div>
				</div>
			</div>
			<div id="saida" class="col-md-3 visible-md visible-lg"></div>
		</div>
	</div>
</body>
<script src="../lib/jquery-1.11.1.min.js"></script>
	<!-- >script src="../js/bootstrap.js"></script-->
	<script src="../dist/jquery.bootgrid.js"></script>
	<script src="../dist/jquery.bootgrid.fa.js"></script>
	<script src="../js/bootstrap.bundle.js"></script>
	<script src="../js/jquery.rowspanizer.js"></script>
<script>
for( y = 2017; y <= 2500 ; y++){
	var optn = document.createElement("OPTION");
	optn.text = y;
	optn.value = y;
	if ( y == 2018 ){
		optn.selected = true;	
	}
	document.getElementById('ano').options.add(optn);
}

$(document).ready(function() {
	$('#AjaxLoader').hide(); 
	$(document).ready(function() {
		$("#gridRel").bootgrid({
				formatters : {
					"link" : function(column, row) {
						return "<a href=\"#\">" + column.id + ": "
								+ row.id + "</a>";
					}
				},
				rowCount : [ -1, 10, 50, 75 ]
			});
	});
	
	$('#ano').change(function() {
		var anoSelecionado = $(this).children("option:selected").val();
		$("#gridRel").bootgrid("clear");
		//console.log('anoSelecionado:'+anoSelecionado);
		$('#AjaxLoader').show();  
		$.ajax({
			  type: "GET",
			  url: "anualItens/"+anoSelecionado,
			  contentType: "application/json; charset=utf-8",
			  //data: {anoSelecionado},
			  //data: JSON.parse(dataSend),
			  success: function(resultado) {
				  strJson = resultado;
				  console.log(JSON.stringify(strJson));
				  var iCount = 0;
				  for (var i = 0; i < resultado.length; i++) {
						//console.log('DEBUG - length itens doados:'+resultado[i].itensDoados.length);
						for (var y = 0; y < resultado[i].mes.length; y++) {
							for (var a = 0; a < resultado[i].mes[y].itensDoados.length; a++) {
								$("#gridRel").bootgrid("append",[{
									id : iCount,
									ano : resultado[i].ano,
									mes : resultado[i].mes[y].descricao,
									entidade: resultado[i].nome,
									quantidade: resultado[i].mes[y].itensDoados[a].quantidade,
									tipo: resultado[i].mes[y].itensDoados[a].tipo
								}]);
								iCount++;
							}
						}
					}
				  //$("#gridRel").rowspanizer({columns: [2,3,4]});
				  $('#AjaxLoader').hide();
			  } ,
			  error: function(e){
				console.log('ERRO:' + JSON.stringify(e));
			  }
		});
		
	}); 
});

</script>
</html>
